# 추가 아키텍처 도식

## 1. 시퀀스 다이어그램 - 포트폴리오 조회

```
사용자     프론트엔드    백엔드API     데이터베이스   PriceUpdater
  │           │           │             │              │
  │ 1. 포트폴리오 요청    │             │              │
  ├──────────▶│           │             │              │
  │           │ 2. GET /api/balance/all │              │
  │           ├──────────▶│             │              │
  │           │           │ 3. 보유종목 조회            │
  │           │           ├────────────▶│              │
  │           │           │◄────────────┤              │
  │           │           │ 4. 예수금 조회              │
  │           │           ├────────────▶│              │
  │           │           │◄────────────┤              │
  │           │           │ 5. 리밸런싱 상태 조회        │
  │           │           ├────────────▶│              │
  │           │           │◄────────────┤              │
  │           │ 6. 통합 응답 데이터       │              │
  │           │◄──────────┤             │              │
  │ 7. 포트폴리오 표시    │             │              │
  │◄──────────┤           │             │              │
  │           │           │             │              │
  │           │ 8. 실시간 업데이트 (폴링) │              │
  │           ├───────────────────────────────────────▶│
  │           │◄───────────────────────────────────────┤
  │           │           │             │              │
```

## 2. 시퀀스 다이어그램 - AI 전략 학습

```
관리자     프론트엔드    백엔드API     AI학습모듈    데이터베이스
  │           │           │             │              │
  │ 1. 전략 생성 요청     │             │              │
  ├──────────▶│           │             │              │
  │           │ 2. POST /api/strategy-learning/generate/auto │
  │           ├──────────▶│             │              │
  │           │           │ 3. AI 분석 요청             │
  │           │           ├────────────▶│              │
  │           │           │             │ 4. 시장 데이터 분석 │
  │           │           │             │              │
  │           │           │             │ 5. 전략 생성  │
  │           │           │◄────────────┤              │
  │           │           │ 6. 전략 저장               │
  │           │           ├────────────────────────────▶│
  │           │           │◄────────────────────────────┤
  │           │ 7. 생성 완료 응답         │              │
  │           │◄──────────┤             │              │
  │ 8. 생성 결과 표시     │             │              │
  │◄──────────┤           │             │              │
  │           │           │             │              │
  │ 9. 전략 승인/거부     │             │              │
  ├──────────▶│           │             │              │
  │           │ 10. PUT /api/strategy-learning/status    │
  │           ├──────────▶│             │              │
  │           │           │ 11. 상태 업데이트           │
  │           │           ├────────────────────────────▶│
  │           │           │◄────────────────────────────┤
  │           │ 12. 업데이트 완료         │              │
  │           │◄──────────┤             │              │
```

## 3. 데이터 플로우 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                        데이터 플로우                            │
└─────────────────────────────────────────────────────────────────┘

외부 입력                실시간 처리               데이터 저장
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│ 사용자 요청  │────────▶│ API 서버    │────────▶│ MariaDB     │
│ - 포트폴리오 │         │ - 인증/인가  │         │ - 고객잔고   │
│ - 전략 설정  │         │ - 데이터변환 │         │ - 거래내역   │
│ - 리밸런싱  │         │ - 비즈니스   │         │ - 전략정보   │
└─────────────┘         │   로직      │         └─────────────┘
                        └─────────────┘
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│ 시장 데이터  │────────▶│ 가격 업데이터│────────▶│ 실시간 주가  │
│ - 주식 시세  │         │ - 1초 간격   │         │ - 2500종목   │
│ - 거래량    │         │ - ±5% 변동   │         │ - 변동률    │
│ - 시가총액  │         │ - 메모리관리  │         │ - 거래량    │
└─────────────┘         └─────────────┘         └─────────────┘

┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│ AI 학습 입력 │────────▶│ 전략생성엔진 │────────▶│ 학습된 전략  │
│ - 텍스트    │         │ - 자연어처리 │         │ - 위험수준   │
│ - URL      │         │ - 문서분석   │         │ - 수익률    │
│ - 문서파일  │         │ - 패턴인식   │         │ - 포트폴리오 │
└─────────────┘         └─────────────┘         └─────────────┘

데이터 흐름 방향:
입력 → 처리 → 저장 → 조회 → 출력
 ↑                           ↓
 └─────── 피드백/업데이트 ──────┘
```

## 4. 배포 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                        배포 환경                                │
└─────────────────────────────────────────────────────────────────┘

개발 환경 (Development)
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   개발자 PC      │    │   로컬 서버      │    │   로컬 DB       │
│                │    │                │    │                │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │ IDE/Editor  │ │    │ │ Node.js     │ │    │ │ MariaDB     │ │
│ │ - VS Code   │ │    │ │ - Express   │ │    │ │ - Port 3306 │ │
│ │ - Git       │ │────▶│ │ - Port 3001 │ │────▶│ │ - kpsdb     │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    └─────────────────┘
│ │ Browser     │ │    │ │ Vite Dev    │ │
│ │ - Port 8080 │ │◄───│ │ - Port 5173 │ │
│ └─────────────┘ │    │ └─────────────┘ │
└─────────────────┘    └─────────────────┘

프로덕션 환경 (Production)
┌─────────────────────────────────────────────────────────────────┐
│                      리눅스 서버                                 │
│                                                                │
│ ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐│
│ │ 프론트엔드        │    │ 백엔드           │    │ 데이터베이스      ││
│ │                │    │                │    │                ││
│ │ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ ││
│ │ │ Vite Build  │ │    │ │ Node.js     │ │    │ │ MariaDB     │ ││
│ │ │ - Port 8080 │ │    │ │ - Port 3001 │ │    │ │ - Port 3306 │ ││
│ │ │ - Nginx?    │ │    │ │ - PM2?      │ │    │ │ - kpsdb     │ ││
│ │ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ ││
│ └─────────────────┘    └─────────────────┘    └─────────────────┘│
│                                                                │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                    관리 스크립트                             │ │
│ │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │ │
│ │ │ start.sh    │ │ stop.sh     │ │ status.sh   │ │ logs/   │ │ │
│ │ │ - 시스템시작 │ │ - 정상종료   │ │ - 상태점검   │ │ - 로깅  │ │ │
│ │ └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 5. 보안 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                        보안 계층                                │
└─────────────────────────────────────────────────────────────────┘

외부 접근                네트워크 보안           애플리케이션 보안
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│ 사용자       │         │ CORS 설정    │         │ 입력 검증    │
│ - 웹브라우저  │────────▶│ - localhost  │────────▶│ - SQL 인젝션 │
│ - 관리자     │         │ - 개발환경    │         │   방지      │
└─────────────┘         │ - 포트제한    │         │ - XSS 방지   │
                        └─────────────┘         │ - 파일업로드  │
                                                │   검증      │
데이터 보안              │                      └─────────────┘
┌─────────────┐         │              
│ 데이터베이스  │         │                     인증/인가
│ - 접근제어   │◄────────┘                     ┌─────────────┐
│ - 암호화    │                               │ 현재 미구현  │
│ - 백업      │                               │ - JWT?      │
└─────────────┘                               │ - Session?  │
                                             │ - OAuth?    │
모니터링/로깅                                 └─────────────┘
┌─────────────┐
│ 보안 이벤트  │
│ - 접근 로그  │
│ - 오류 추적  │
│ - 성능 모니터 │
└─────────────┘

현재 보안 상태:
✅ CORS 설정됨
✅ SQL Prepared Statement 사용
✅ 파일 업로드 타입 제한
❌ 인증/인가 미구현 (개발환경)
❌ HTTPS 미적용 (개발환경)
❌ 데이터 암호화 미적용
```

## 6. 성능 최적화 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                      성능 최적화 전략                             │
└─────────────────────────────────────────────────────────────────┘

프론트엔드 최적화           백엔드 최적화            데이터베이스 최적화
┌─────────────┐            ┌─────────────┐           ┌─────────────┐
│ React Query │            │ 연결 풀링    │           │ 인덱스 최적화 │
│ - 캐싱      │            │ - 최대 10개  │           │ - 계좌번호   │
│ - 중복 요청  │            │ - 재사용     │           │ - 종목코드   │
│   제거      │◄──────────▶│ - 타임아웃   │◄─────────▶│ - 거래일시   │
│ - 백그라운드 │            │   관리      │           │ - 업데이트   │
│   업데이트   │            └─────────────┘           │   시간      │
└─────────────┘                                     └─────────────┘
        │                  메모리 관리               
        │                  ┌─────────────┐           캐싱 전략
        │                  │ PriceUpdater│           ┌─────────────┐
        └─────────────────▶│ - 배치처리   │◄─────────▶│ 실시간 데이터│
                          │ - GC 최적화  │           │ - 1초 TTL   │
                          │ - 메모리임계값│           │ 정적 데이터  │
                          └─────────────┘           │ - 1시간 TTL │
                                                   └─────────────┘

성능 모니터링
┌─────────────────────────────────────────────────────────────────┐
│ 응답시간 측정  │  메모리 사용량  │  DB 쿼리 성능  │  동시 접속   │
│ - API 응답     │  - 힙 메모리   │  - 실행계획   │  - 사용자수  │
│ - 페이지 로딩   │  - GC 빈도    │  - 슬로우쿼리  │  - 커넥션풀  │
└─────────────────────────────────────────────────────────────────┘

성능 지표:
- API 응답시간: < 200ms (목표)
- 페이지 로딩: < 1초 (목표)  
- 메모리 사용량: < 4GB (제한)
- DB 쿼리: < 100ms (목표)
```

## 7. 에러 처리 흐름도

```
┌─────────────────────────────────────────────────────────────────┐
│                        에러 처리 플로우                          │
└─────────────────────────────────────────────────────────────────┘

사용자 요청
     │
     ▼
┌─────────────┐    YES  ┌─────────────┐    YES  ┌─────────────┐
│ 입력 검증    │────────▶│ 비즈니스로직 │────────▶│ 성공 응답    │
│ - 필수값    │         │ - DB 쿼리   │         │ - 200 OK    │
│ - 타입 체크  │         │ - 계산      │         │ - 데이터    │
│ - 범위 체크  │         │ - 변환      │         └─────────────┘
└─────────────┘         └─────────────┘
     │ NO                      │ NO
     ▼                         ▼
┌─────────────┐              ┌─────────────┐
│ 400 에러     │              │ 500 에러     │
│ - Bad Request│              │ - DB 에러   │
│ - 메시지     │              │ - 시스템에러 │
│ - 상세내용   │              │ - 로그 기록  │
└─────────────┘              └─────────────┘
     │                         │
     └─────────┬───────────────┘
               ▼
        ┌─────────────┐
        │ 프론트엔드   │
        │ - 토스트    │
        │ - 사용자    │
        │   안내     │
        └─────────────┘

에러 타입별 처리:
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ 네트워크에러 │  │ 인증 에러    │  │ 권한 에러    │  │ 데이터에러   │
│ - 재시도    │  │ - 로그인유도 │  │ - 접근거부   │  │ - 새로고침   │
│ - 오프라인  │  │ - 401       │  │ - 403       │  │ - 404/409   │
└─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘
```