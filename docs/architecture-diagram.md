# 시스템 아키텍처 다이어그램

## 1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────┐
│                        포트폴리오 관리 시스템                        │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    사용자        │    │    관리자        │    │   시스템 관리    │
│   (고객용)       │    │   (관리자용)     │    │  (스크립트)      │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │ HTTP 요청             │ HTTP 요청             │ 프로세스 관리
          │ (포트: 8080)          │ (포트: 8080)          │
          │                      │                      │
          └──────────────────────┼──────────────────────┼─────────┐
                                 │                      │         │
                                 ▼                      ▼         │
┌─────────────────────────────────────────────────────────────────────┐│
│                     프론트엔드 (React SPA)                           ││
│  ┌─────────────────────────────────────────────────────────────────┐││
│  │ • Vite + TypeScript + Tailwind CSS                            │││
│  │ • React Router (라우팅)                                        │││
│  │ • React Query (서버 상태 관리)                                  │││
│  │ • shadcn/ui (UI 컴포넌트)                                      │││
│  │ • 반응형 모바일 우선 디자인                                      │││
│  └─────────────────────────────────────────────────────────────────┘││
└──────────────────────────┬──────────────────────────────────────────┘│
                           │ REST API 호출 (포트: 3001)                │
                           ▼                                           │
┌─────────────────────────────────────────────────────────────────────┐│
│                    백엔드 (Node.js/Express)                         ││
│  ┌─────────────────────────────────────────────────────────────────┐││
│  │ API 서버 (server.js)                                           │││
│  │ ├─ CORS 설정                                                   │││
│  │ ├─ JSON 파싱                                                   │││
│  │ ├─ 요청 로깅                                                   │││
│  │ └─ 멀터 파일 업로드                                             │││
│  │                                                               │││
│  │ 주요 모듈:                                                     │││
│  │ ├─ database.js (DB 연결 풀 & 쿼리)                             │││
│  │ ├─ priceUpdater.js (실시간 주가 시뮬레이션)                      │││
│  │ └─ API 라우터들 (balance, strategy-learning, price)            │││
│  └─────────────────────────────────────────────────────────────────┘││
└──────────────────────────┬──────────────────────────────────────────┘│
                           │ MySQL 연결 (mysql2/promise)               │
                           ▼                                           │
┌─────────────────────────────────────────────────────────────────────┐│
│                     데이터베이스 (MariaDB)                           ││
│  ┌─────────────────────────────────────────────────────────────────┐││
│  │ 포트폴리오 데이터                                                │││
│  │ ├─ customer_balance (고객 잔고)                                 │││
│  │ ├─ stock_current_price (실시간 주가)                            │││
│  │ ├─ trading_history (거래 기록)                                  │││
│  │ ├─ customer_strategy (전략 설정)                                │││
│  │ ├─ rebalancing_master (마스터 전략)                             │││
│  │ └─ strategy_learning (AI 학습 전략)                             │││
│  │                                                               │││
│  │ 특징:                                                         │││
│  │ ├─ 연결 풀링 (최대 10개 연결)                                   │││
│  │ ├─ 트랜잭션 지원                                                │││
│  │ └─ 약 2500개 한국 주식 데이터                                   │││
│  └─────────────────────────────────────────────────────────────────┘││
└─────────────────────────────────────────────────────────────────────┘│
                                                                      │
┌─────────────────────────────────────────────────────────────────────┐│
│                       운영 환경 (Production)                        ││
│  ┌─────────────────────────────────────────────────────────────────┐││
│  │ 스크립트 기반 프로세스 관리                                       │││
│  │ ├─ start.sh (시스템 시작)                                       │││
│  │ ├─ stop.sh (정상 종료)                                          │││
│  │ ├─ status.sh (상태 모니터링)                                    │││
│  │ └─ 로그 관리 (/logs 디렉토리)                                   │││
│  │                                                               │││
│  │ 모니터링:                                                      │││
│  │ ├─ PID 추적                                                    │││
│  │ ├─ 포트 상태 확인                                               │││
│  │ ├─ 헬스체크 API                                                 │││
│  │ └─ 데이터베이스 연결 테스트                                      │││
│  └─────────────────────────────────────────────────────────────────┘││
└─────────────────────────────────────────────────────────────────────┘│
                                                                      │
                                ┌─────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      외부 통합 (External Integration)                │
│  ┌─────────────────────────────────────────────────────────────────┐
│  │ AI 전략 학습 시스템                                               │
│  │ ├─ 사용자 입력 기반 전략 생성                                     │
│  │ ├─ 웹사이트 내용 분석                                            │
│  │ ├─ 문서 파일 분석 (PDF, DOC, TXT, PPT)                          │
│  │ └─ 자동 시장 분석 기반 생성                                       │
│  │                                                               │
│  │ 실시간 주가 시뮬레이션                                            │
│  │ ├─ 1000ms 간격 자동 업데이트                                     │
│  │ ├─ 0.95-1.05배 가격 변동                                        │
│  │ ├─ 메모리 관리 및 배치 처리                                      │
│  │ └─ API 기반 제어 (시작/중지/재시작)                               │
│  └─────────────────────────────────────────────────────────────────┘
└─────────────────────────────────────────────────────────────────────┘
```

## 2. 데이터 흐름 다이어그램

```
사용자 액션 → 프론트엔드 → API 호출 → 백엔드 → 데이터베이스
     ↑                                              ↓
     └────────── 응답 데이터 ←────────────────────────┘

실시간 업데이트:
┌─────────────┐    ┌──────────────┐    ┌─────────────┐
│ PriceUpdater│────▶│ MariaDB      │────▶│ 폴링으로     │
│ (1000ms)    │    │ 주가 업데이트 │    │ 프론트엔드   │
└─────────────┘    └──────────────┘    └─────────────┘
```

## 3. 컴포넌트 구조

```
포트폴리오 관리 시스템
├── 프론트엔드 (React)
│   ├── 페이지 컴포넌트
│   │   ├── Index.tsx (포트폴리오 대시보드)
│   │   ├── StrategyCreate.tsx (전략 생성)
│   │   ├── StrategyCompare.tsx (전략 비교)
│   │   └── admin/
│   │       ├── PortfolioManagement.tsx
│   │       ├── StrategyLearning.tsx
│   │       └── StrategyDetail.tsx
│   ├── 공통 컴포넌트
│   │   ├── BottomNavigation.tsx
│   │   ├── PortfolioCard.tsx
│   │   ├── PortfolioComposition.tsx
│   │   └── ui/ (shadcn/ui 컴포넌트)
│   └── 훅 & 유틸리티
│       ├── useBalance.ts
│       ├── useRealTimeBalance.ts
│       └── api/balance.ts
│
├── 백엔드 (Node.js)
│   ├── server.js (메인 서버)
│   ├── database.js (DB 연결 & 쿼리)
│   ├── priceUpdater.js (주가 업데이트)
│   └── API 라우터
│       ├── /api/balance/*
│       ├── /api/strategy-learning/*
│       └── /api/price/*
│
└── 데이터베이스 (MariaDB)
    ├── 고객 관련
    │   ├── customer_balance
    │   ├── customer_deposit
    │   └── customer_strategy
    ├── 주식 관련
    │   ├── stock_current_price
    │   ├── stock_info
    │   └── trading_history
    └── 전략 관련
        ├── rebalancing_master
        ├── strategy_learning
        └── strategy_settings
```